version: '2.1'

services:
  protonmail-bridge:
    image: ghcr.io/enucatl/protonmail-bridge:master
    user: "8535:8535"
    build:
      context: ./build
      dockerfile: Dockerfile
    container_name: pm_bridge
    restart: unless-stopped
    stdin_open: true 
    tty: true
    networks:
      - traefik_proxy
    volumes:
      - protonmail:/home/protonmail
      - /home/user/docker/traefik/data/certs/protonmail-bridge.nuc10i7fnh.home.arpa/privkey.pem:/home/protonmail/.config/protonmail/bridge/key.pem:ro
      - /home/user/docker/traefik/data/certs/protonmail-bridge.nuc10i7fnh.home.arpa/fullchain.pem:/home/protonmail/.config/protonmail/bridge/cert.pem:ro
    labels:
      - 'traefik.enable=true'
      - 'traefik.tcp.routers.protonmail-bridge-imap.rule=HostSNI(`*`)'
      - 'traefik.tcp.routers.protonmail-bridge-imap.entrypoints=protonmail-bridge-imap'
      - 'traefik.tcp.routers.protonmail-bridge-imap.tls.passthrough=true'
      - 'traefik.tcp.services.protonmail-bridge-imap.loadbalancer.server.port=1243'
      - 'traefik.tcp.routers.protonmail-bridge-imap.service=protonmail-bridge-imap'

volumes:
  protonmail:
    name: protonmail

networks:
  traefik_proxy:
    external: true
